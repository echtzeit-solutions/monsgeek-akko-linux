#!/bin/bash
# Pre-commit hook: runs format check and clippy on Rust code

set -e

cd "$(git rev-parse --show-toplevel)/iot_driver_linux"

echo "=== Running cargo fmt --check ==="
if ! cargo fmt --check; then
    echo ""
    echo "ERROR: Code is not formatted. Run 'cargo fmt' to fix."
    exit 1
fi

echo "=== Running cargo clippy ==="
if ! cargo clippy --features firmware-api -- -D warnings 2>&1; then
    echo ""
    echo "ERROR: Clippy found issues. Fix them before committing."
    exit 1
fi

echo "=== Pre-commit checks passed ==="
